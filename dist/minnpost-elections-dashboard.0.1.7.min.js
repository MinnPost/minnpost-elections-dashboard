/*! MinnPost Elections Dashboard - v0.1.7 - 2020-11-03
* https://github.com/MinnPost/minnpost-elections-dashboard
* Copyright (c) 2020 MinnPost; Licensed MIT */

LazyLoad=function(a){function b(b,c){var d,e=a.createElement(b);for(d in c)c.hasOwnProperty(d)&&e.setAttribute(d,c[d]);return e}function c(a){var b,c,d=j[a];d&&(b=d.callback,c=d.urls,c.shift(),k=0,c.length||(b&&b.call(d.context,d.obj),j[a]=null,l[a].length&&e(a)))}function d(){var b=navigator.userAgent;h={async:!0===a.createElement("script").async},(h.webkit=/AppleWebKit\//.test(b))||(h.ie=/MSIE|Trident/.test(b))||(h.opera=/Opera/.test(b))||(h.gecko=/Gecko\//.test(b))||(h.unknown=!0)}function e(e,k,m,n,o){var p,q,r,s,t,u,v=function(){c(e)},w="css"===e,x=[];if(h||d(),k)if(k="string"==typeof k?[k]:k.concat(),w||h.async||h.gecko||h.opera)l[e].push({urls:k,callback:m,obj:n,context:o});else for(p=0,q=k.length;p<q;++p)l[e].push({urls:[k[p]],callback:p===q-1?m:null,obj:n,context:o});if(!j[e]&&(s=j[e]=l[e].shift())){for(i||(i=a.head||a.getElementsByTagName("head")[0]),t=s.urls.concat(),p=0,q=t.length;p<q;++p)u=t[p],w?r=h.gecko?b("style"):b("link",{href:u,rel:"stylesheet"}):(r=b("script",{src:u}),r.async=!1),r.className="lazyload",r.setAttribute("charset","utf-8"),h.ie&&!w&&"onreadystatechange"in r&&!("draggable"in r)?r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&(r.onreadystatechange=null,v())}:w&&(h.gecko||h.webkit)?h.webkit?(s.urls[p]=r.href,g()):(r.innerHTML='@import "'+u+'";',f(r)):r.onload=r.onerror=v,x.push(r);for(p=0,q=x.length;p<q;++p)i.appendChild(x[p])}}function f(a){var b;try{b=!!a.sheet.cssRules}catch(d){return k+=1,void(k<200?setTimeout(function(){f(a)},50):b&&c("css"))}c("css")}function g(){var a,b=j.css;if(b){for(a=m.length;--a>=0;)if(m[a].href===b.urls[0]){c("css");break}k+=1,b&&(k<200?setTimeout(g,50):c("css"))}}var h,i,j={},k=0,l={css:[],js:[]},m=a.styleSheets;return{css:function(a,b,c,d){e("css",a,b,c,d)},js:function(a,b,c,d){e("js",a,b,c,d)}}}(this.document),define("lazyload",function(a){return function(){var b;return b||a.LazyLoad}}(this)),define("text!../bower.json",[],function(){return'{\n  "name": "minnpost-elections-dashboard",\n  "version": "0.1.0",\n  "main": "index.html",\n  "ignore": [\n    "**/.*",\n    "node_modules",\n    "components",\n    "bower_components"\n  ],\n  "dependencies": {\n    "ractive": "~0.5.6",\n    "ractive-events-tap": "~0.1.1",\n    "requirejs": "~2.1.15",\n    "almond": "~0.3.0",\n    "text": "~2.0.12",\n    "underscore": "~1.7.0",\n    "jquery": "~1.11.1",\n    "minnpost-styles": "master",\n    "rgrove-lazyload": "*",\n    "backbone": "~1.1.2",\n    "leaflet": "0.7.3",\n    "momentjs": "~2.8.1",\n    "typeahead.js": "~0.10.4",\n    "Placeholders.js": "~3.0.0",\n    "ractive-backbone": "~0.1.1",\n    "moment-timezone": "~0.2.1",\n    "screenfull": "~1.2.1"\n  },\n  "dependencyMap": {\n    "requirejs": {\n      "rname": "requirejs",\n      "js": [\n        "requirejs/require"\n      ]\n    },\n    "almond": {\n      "rname": "almond",\n      "js": [\n        "almond/almond"\n      ]\n    },\n    "text": {\n      "rname": "text",\n      "js": [\n        "text/text"\n      ]\n    },\n    "jquery": {\n      "rname": "jquery",\n      "js": [\n        "jquery/dist/jquery"\n      ],\n      "returns": "$"\n    },\n    "underscore": {\n      "rname": "underscore",\n      "js": [\n        "underscore/underscore"\n      ],\n      "returns": "_"\n    },\n    "ractive": {\n      "rname": "ractive",\n      "js": [\n        "ractive/ractive-legacy"\n      ],\n      "returns": "Ractive"\n    },\n    "ractive-events-tap": {\n      "rname": "ractive-events-tap",\n      "js": [\n        "ractive-events-tap/ractive-events-tap"\n      ],\n      "returns": "RactiveEventsTap"\n    },\n    "ractive-backbone": {\n      "rname": "ractive-backbone",\n      "js": [\n        "ractive-backbone/ractive-backbone"\n      ],\n      "returns": "RactiveBackbone"\n    },\n    "leaflet": {\n      "rname": "leaflet",\n      "js": [\n        "leaflet/dist/leaflet-src"\n      ],\n      "css": [\n        "leaflet/dist/leaflet"\n      ],\n      "images": [\n        "leaflet/dist/images"\n      ],\n      "returns": "L"\n    },\n    "momentjs": {\n      "rname": "moment",\n      "js": [\n        "momentjs/moment"\n      ],\n      "returns": "moment"\n    },\n    "moment-timezone": {\n      "rname": "moment-timezone",\n      "js": [\n        "moment-timezone/builds/moment-timezone-with-data"\n      ],\n      "returns": "momentTimezone"\n    },\n    "Placeholders.js": {\n      "rname": "placeholders-js",\n      "js": [\n        "Placeholders.js/build/placeholders.jquery"\n      ],\n      "returns": "placeholders"\n    },\n    "typeahead.js": {\n      "rname": "typeahead-js",\n      "js": [\n        "typeahead.js/dist/typeahead.jquery"\n      ],\n      "returns": "typeahead"\n    },\n    "bloodhound": {\n      "rname": "bloodhound",\n      "js": [\n        "typeahead.js/dist/bloodhound"\n      ],\n      "returns": "Bloodhound"\n    },\n    "screenfull": {\n      "rname": "screenfull",\n      "js": [\n        "screenfull/dist/screenfull"\n      ],\n      "returns": "screenfull"\n    },\n    "minnpost-styles": {\n      "rname": "mpStyles",\n      "css": [\n        "//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css",\n        "minnpost-styles/dist/minnpost-styles"\n      ],\n      "sass": [\n        "minnpost-styles/styles/main"\n      ]\n    },\n    "mpConfig": {\n      "rname": "mpConfig",\n      "js": [\n        "minnpost-styles/dist/minnpost-styles.config"\n      ],\n      "returns": "mpConfig"\n    },\n    "mpFormatters": {\n      "rname": "mpFormatters",\n      "js": [\n        "minnpost-styles/dist/minnpost-styles.formatters"\n      ],\n      "returns": "mpFormatters"\n    },\n    "mpMaps": {\n      "rname": "mpMaps",\n      "js": [\n        "minnpost-styles/dist/minnpost-styles.maps"\n      ],\n      "returns": "mpMaps"\n    }\n  }\n}\n'}),define("base",["jquery","underscore","backbone","lazyload","mpFormatters","text!../bower.json"],function(a,b,c,d,e,f){"use strict";var g={};return f=JSON.parse(f),g.BaseApp=function(c){this.options=b.extend(this.baseDefaults||{},this.defaults||{},c||{}),this.name=this.options.name,this.options.el&&(this.el=this.options.el,this.$el=a(this.el),this.$=function(a){return this.$el.find(a)}),this.determinePaths(),this.renderAssests(),this.on("cssLoaded",function(){this.initialize.apply(this,arguments)})},b.extend(g.BaseApp.prototype,c.Events,{bower:f,baseDefaults:{jsonpProxy:"//mp-jsonproxy.herokuapp.com/proxy?url=",availablePaths:{local:{css:[".tmp/css/main.css"],images:"images/",data:"data/"},build:{css:["dist/[[[PROJECT_NAME]]].libs.min.css","dist/[[[PROJECT_NAME]]].latest.min.css"],images:"dist/images/",data:"dist/data/"},deploy:{css:["//s3.amazonaws.com/data.minnpost/projects/[[[PROJECT_NAME]]]/[[[PROJECT_NAME]]].libs.min.css","//s3.amazonaws.com/data.minnpost/projects/[[[PROJECT_NAME]]]/[[[PROJECT_NAME]]].latest.min.css"],images:"//s3.amazonaws.com/data.minnpost/projects/[[[PROJECT_NAME]]]/images/",data:"//s3.amazonaws.com/data.minnpost/projects/[[[PROJECT_NAME]]]/data/"}}},determinePaths:function(){var a;return b.isObject(this.options.paths)&&!b.isUndefined(this.options.deployment)?this.options.paths:(this.options.deployment="deploy",-1!==window.location.host.indexOf("localhost")&&(this.options.deployment="local",a=this.parseQueryString(),b.isObject(a)&&b.isString(a.mpDeployment)&&(this.options.deployment=a.mpDeployment)),this.options.paths=this.options.availablePaths[this.options.deployment],this.options.paths)},renderAssests:function(){var a=this,c=[];b.each(this.bower.dependencyMap,function(d,e){d.css&&b.each(d.css,function(b,d){"local"===a.options.deployment?(b=b.match(/^(http|\/\/)/)?b:"bower_components/"+b+".css",c.push(a.makePath(b))):b.match(/^(http|\/\/)/)&&c.push(a.makePath(b))})}),b.each(this.options.paths.css,function(b,d){c.push(a.makePath(b))}),d.css(c,function(){this.trigger("cssLoaded")},null,this)},makePath:function(a){return a=a.split("[[[PROJECT_NAME]]]").join(this.name),this.options.basePath&&!a.match(/^(http|\/\/)/)&&(a=this.options.basePath+a),a},overrideBackboneAJAX:function(){c.ajax=function(){var a=arguments[0];return!0!==a.dataTypeForce?this.jsonpRequest(a):c.$.ajax.apply(c.$,[a])}},isMSIE:function(){var a=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return!!a&&parseInt(a[2],10)},parseQueryString:function(){var a={},c=function(a){return decodeURIComponent(a.replace(/\+/g," "))},d=location.search.substring(1),e=d.split("&");return b.each(e,function(b,d){var e=b.split("=");e.length>1&&(a[c(e[0])]=c(e[1]))}),a},jsonpRequest:function(b){return b.dataType="jsonp",this.options.jsonpProxy&&-1===b.url.indexOf("callback=")&&(b.jsonpCallback="mpServerSideCachingHelper"+e.hash(b.url),b.url=this.options.jsonpProxy+encodeURIComponent(b.url)+"&callback="+b.jsonpCallback,b.cache=!0),a.ajax.apply(a,[b])},dataRequest:function(c){var d=this,e=!1,f=[];return c=b.isArray(name)?c:[c],0===this.options.paths.data.indexOf("http")&&(e=!0),b.each(c,function(b){var c=e?d.jsonpRequest(d.options.paths.data+b):a.getJSON(d.options.paths.data+b);f.push(c)}),a.when.apply(a,f)},initialize:function(){}}),g.BaseApp.extend=c.Model.extend,g}),define("helpers",["jquery","underscore","backbone","moment","mpFormatters"],function(a,b,c,d,e){var f={},g={};return f.overrideBackboneAJAX=function(){c.ajax=function(){var a,d=arguments;return!0!==d[0].dataTypeForce&&(a=e.hash(d[0].url),g[a]=b.isUndefined(g[a])?0:g[a]+1,d[0].dataType="jsonp",d[0].jsonpCallback="mpServerSideCachingHelper"+a+g[a]),c.$.ajax.apply(c.$,d)}},b.isObject(d)&&(d.fn.formatToday=function(a,b){var c=d();return a=a||"[at] h:mm a",b=b||"[on] MMM DD",this.date()===c.date()&&Math.abs(this.diff(c))<864e5?this.format(a):this.format(b)}),f.isMSIE=function(){var a=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return!!a&&parseInt(a[2],10)},f.jsonpRequest=function(c,d){var f=c;return!0!==f.dataTypeForce&&(hash=e.hash(f.url),g[hash]=b.isUndefined(g[hash])?0:g[hash]+1,f.dataType="jsonp",f.jsonpCallback="mpServerSideCachingHelper"+hash+g[hash]),a.ajax.apply(a,[f])},f.getLocalData=function(c,d){var e=!1,g=[];return c=b.isArray(c)?c:[c],d&&d.paths&&0===d.paths.data.indexOf("http")&&(e=!0),b.each(c,function(b){var c;c=e?f.jsonpRequest({url:proxyPrefix+encodeURI(d.paths.data+b)},d):a.getJSON(d.paths.data+b),g.push(c)}),a.when.apply(a,g)},f.parseQueryString=function(){var a={},c=function(a){return decodeURIComponent(a.replace(/\+/g," "))},d=location.search.substring(1),e=d.split("&");return b.each(e,function(b,d){var e=b.split("=");e.length>1&&(a[c(e[0])]=c(e[1]))}),a},f}),define("models",["jquery","underscore","backbone","moment","moment-timezone","helpers"],function(a,b,c,d,e,f){var g={};return g.ContestModel=c.Model.extend({query:"SELECT r.*, c.* FROM contests AS c LEFT JOIN results AS r ON c.id = r.contest_id WHERE c.id = '%CONTEST_ID%' ORDER BY r.percentage ASC, r.candidate",contestFields:["id","contest_id","boundary","county_id","district_code","office_id","precinct_id","precincts_reporting","question_body","ranked_choice","results_group","seats","state","title","sub_title","total_effected_precincts","total_votes_for_office","updated","question_body","question_help","primary","scope","partisan","incumbent_party","percent_needed","called"],npParties:["NP","WI"],initialize:function(a,b){this.options=b||{},this.app=b.app,this.on("sync",this.contestUpdate)},url:function(){return this.app.options.electionsAPI+encodeURIComponent(this.query.replace("%CONTEST_ID%",this.id))},parse:function(a,c){var e=this,f={},g=!1;if(f.results=[],c.collection)return a;if(b.each(a,function(a){var c={};b.each(a,function(a,d){b.indexOf(e.contestFields,d)>=0?f[d]=a:c[d]=a}),f.results.push(c)}),f.ranked_choice){var h={};b.each(f.results,function(a){var c=a.ranked_choice_place;h[a.candidate_id]=h[a.candidate_id]||{},h[a.candidate_id].ranked_choices=h[a.candidate_id].ranked_choices||{},h[a.candidate_id].ranked_choices[c]={ranked_choice:c,percentage:a.percentage,votes_candidate:a.votes_candidate,office_name:a.office_name},1===c&&(h[a.candidate_id]=b.extend(h[a.candidate_id],a)),100===c&&(h[a.candidate_id].percentage=a.percentage,h[a.candidate_id].votes_candidate=a.votes_candidate)}),f.results=b.values(h)}return f.results=b.sortBy(f.results,"candidate"),f.results=b.sortBy(f.results,function(a){return-1*a.votes_candidate}),f.primary&&(f.results=b.sortBy(f.results,"party_id")),f.done=f.precincts_reporting===f.total_effected_precincts,f.ranked_choice&&(g=b.size(f.results)==b.size(b.filter(f.results,function(a){return!b.isUndefined(a.ranked_choices[100])}))),f.percent_needed&&f.percent_needed>0&&f.done?f.results=b.map(f.results,function(a,b){return a.winner=!1,"yes"===a.candidate.toLowerCase()&&a.percentage>=f.percent_needed?a.winner=!0:"no"===a.candidate.toLowerCase()&&a.percentage>100-f.percent_needed&&(a.winner=!0),a}):f.done&&!f.ranked_choice&&!f.primary||f.done&&f.ranked_choice&&g&&!f.primary||f.done&&f.primary&&!f.partisan?(f.results=b.map(f.results,function(a,b){return a.winner=!1,b<f.seats&&!a.percent&&(a.winner=!0),a}),f.final=!0):f.done&&f.primary&&f.partisan&&(b.each(b.groupBy(f.results,"party_id"),function(a,c){b.each(a,function(a,b){return a.winner=!1,b<f.seats&&(a.winner=!0),a})}),f.final=!0),f.updated=d.unix(f.updated),f},contestUpdate:function(){this.set("synced",!0),!this.get("fetchedBoundary")&&b.isString(this.get("boundary"))&&this.fetchBoundary()},fetchBoundary:function(){var a=this;a.set("boundarySets",[]),boundaries=[this.get("boundary")],boundaries[0].includes(",")&&(boundaries=boundaries[0].split(",")),b.each(boundaries,function(b){f.jsonpRequest({url:a.app.options.boundaryAPI+"boundaries/"+encodeURIComponent(b)+"/simple_shape"},a.app.options).done(function(c){c&&(boundarySets=a.get("boundarySets"),boundarySets.push({slug:b,simple_shape:c}),a.set("boundarySets",boundarySets),boundarySets.length==boundaries.length&&a.set("fetchedBoundary",!0))})})},connect:function(a){var b=this;this.set("fetchedBoundary",!1===a),this.fetch(),this.pollID=window.setInterval(function(){b.fetch()},this.app.options.electionsAPIPollInterval)},disconnect:function(){window.clearInterval(this.pollID)}}),g.ElectionModel=c.Model.extend({query:"SELECT * FROM meta",initialize:function(a,b){this.options=b||{},this.app=b.app},url:function(){return this.app.options.electionsAPI+encodeURIComponent(this.query)},parse:function(a,c){var e,f,g={};return b.each(a,function(a,b){"int"===a.type?g[a.key]=parseInt(a.value,10):"float"===a.type?g[a.key]=parseFloat(a.value):"bool"===a.type?g[a.key]=!!a.value:g[a.key]=a.value.toString()}),g.date&&(g.date=d(g.date)),g.updated&&(g.updated=d.unix(g.updated)),g.isTest=!1,g.date&&(e=d().tz("America/Chicago"),f=g.date.clone(),f.tz("America/Chicago").hour(15).minute(0),e.isBefore(f,"minute")&&(g.isTest=!0)),g},connect:function(){var a=this;this.fetch(),this.pollID=window.setInterval(function(){a.fetch()},this.app.options.electionsAPIPollInterval)},disconnect:function(){window.clearInterval(this.pollID)}}),g.CustomQuery=c.Model.extend({query:"SELECT * FROM results LIMIT 10",initialize:function(a,c){this.options=c||{},this.app=c.app,this.query=c.query||this.query,this.parse=c.parse?b.bind(c.parse,this):this.parse},url:function(){return this.app.options.electionsAPI+encodeURIComponent(this.query)},parse:function(a,b){return a},connect:function(){var a=this;this.fetch(),this.pollID=window.setInterval(function(){a.fetch()},this.app.options.electionsAPIPollInterval)},disconnect:function(){window.clearInterval(this.pollID)}}),g}),define("collections",["jquery","underscore","backbone","models","helpers"],function(a,b,c,d,e){var f={};return f.ContestsCollection=c.Collection.extend({model:d.ContestModel,query:"SELECT r.*, c.* FROM contests AS c LEFT JOIN results AS r ON c.id = r.contest_id WHERE (%CONTEST_SEARCH%) ORDER BY c.title, r.percentage, r.candidate ASC LIMIT 400",url:function(){var a=this.options.search.split("|");return a=b.map(a,function(a){return a=a.split(" ").join("%"),"title LIKE '%"+(a=a.split("+").join("%"))+"%' OR sub_title LIKE '%"+a+"%'"}),this.app.options.electionsAPI+encodeURIComponent(this.query.replace("%CONTEST_SEARCH%",a.join(" OR ")))},parse:function(a,c){return b.map(b.values(b.groupBy(a,"id")),this.model.prototype.parse,this.model.prototype)},initialize:function(a,b){this.options=b||{},this.app=b.app,this.on("add",function(a){a.options=b,a.app=b.app}),this.on("sync",function(){this.contestUpdate()})},contestUpdate:function(){this.fetchedBoundary||this.fetchBoundary()},fetchBoundary:function(){var a=this;a.each(function(c){c.set("boundarySets",[]),boundaries=[c.get("boundary")],boundaries[0].includes(",")&&(boundaries=boundaries[0].split(",")),c.set("totalBoundaryCount",boundaries.length),b.each(boundaries,function(b){e.jsonpRequest({url:a.app.options.boundaryAPI+"boundaries/"+encodeURIComponent(b)+"/simple_shape"},a.app.options).done(function(a){a&&(boundarySets=c.get("boundarySets"),boundarySets.push({slug:b,simple_shape:a}),c.set("boundarySets",boundarySets),boundarySets.length==c.get("totalBoundaryCount")&&c.set("fetchedBoundary",!0))})})})},connect:function(){var a=this,b={collection:!0};this.fetch(b),this.pollID=window.setInterval(function(){a.fetch(b)},this.app.options.electionsAPIPollInterval)},disconnect:function(){window.clearInterval(this.pollID)}}),f.ContestsLocationCollection=f.ContestsCollection.extend({query:"SELECT r.*, c.* FROM contests AS c LEFT JOIN results AS r ON c.id = r.contest_id WHERE boundary IN (%CONTEST_SEARCH%) ORDER BY c.title, r.percentage, r.candidate ASC LIMIT 400",url:function(){return this.app.options.electionsAPI+encodeURIComponent(this.query.replace("%CONTEST_SEARCH%","'"+this.boundaries.join("','")+"'"))},initialize:function(a,b){f.ContestsLocationCollection.__super__.initialize.apply(this,arguments),this.on("fetchedBoundary",function(){this.connect()})},contestUpdate:function(){this.matchedBoundary||this.matchBoundary()},matchBoundary:function(){var a=this;b.each(this.fullBoundaries,function(c){var d=c.url.split("/"),f=d[2]+"/"+d[3];b.each(a.where({boundary:f}),function(b){e.jsonpRequest({url:a.app.options.boundaryAPI+"boundaries/"+f+"/simple_shape"},a.app.options).done(function(a){b.set("boundarySets",[{slug:f,simple_shape:a}]),b.set("fetchedBoundary",!0)})})}),this.matchedBoundary=!0},fetchBoundaryFromCoordinates:function(){var a=this;multiMCDs={"minor-civil-divisions-2010/2704904798":"minor-civil-divisions-2010/2704904798,minor-civil-divisions-2010/2715704798","minor-civil-divisions-2010/2715704798":"minor-civil-divisions-2010/2704904798,minor-civil-divisions-2010/2715704798","minor-civil-divisions-2010/2700306382":"minor-civil-divisions-2010/2700306382,minor-civil-divisions-2010/2712306382","minor-civil-divisions-2010/2712306382":"minor-civil-divisions-2010/2700306382,minor-civil-divisions-2010/2712306382","minor-civil-divisions-2010/2705907282":"minor-civil-divisions-2010/2705907282,minor-civil-divisions-2010/2706507282","minor-civil-divisions-2010/2706507282":"minor-civil-divisions-2010/2705907282,minor-civil-divisions-2010/2706507282","minor-civil-divisions-2010/2712108092":"minor-civil-divisions-2010/2712108092,minor-civil-divisions-2010/2714508092","minor-civil-divisions-2010/2714508092":"minor-civil-divisions-2010/2712108092,minor-civil-divisions-2010/2714508092","minor-civil-divisions-2010/2710909154":"minor-civil-divisions-2010/2710909154,minor-civil-divisions-2010/2710909154","minor-civil-divisions-2010/2701910918":"minor-civil-divisions-2010/2701910918,minor-civil-divisions-2010/2705310918","minor-civil-divisions-2010/2705310918":"minor-civil-divisions-2010/2701910918,minor-civil-divisions-2010/2705310918","minor-civil-divisions-2010/2704511008":"minor-civil-divisions-2010/2704511008,minor-civil-divisions-2010/2710911008","minor-civil-divisions-2010/2710911008":"minor-civil-divisions-2010/2704511008,minor-civil-divisions-2010/2710911008","minor-civil-divisions-2010/2714511800":"minor-civil-divisions-2010/2714511800,minor-civil-divisions-2010/2717111800","minor-civil-divisions-2010/2717111800":"minor-civil-divisions-2010/2714511800,minor-civil-divisions-2010/2717111800","minor-civil-divisions-2010/2701512772":"minor-civil-divisions-2010/2701512772,minor-civil-divisions-2010/2703312772","minor-civil-divisions-2010/2703312772":"minor-civil-divisions-2010/2701512772,minor-civil-divisions-2010/2703312772","minor-civil-divisions-2010/2705315022":"minor-civil-divisions-2010/2705315022,minor-civil-divisions-2010/2717115022","minor-civil-divisions-2010/2717115022":"minor-civil-divisions-2010/2705315022,minor-civil-divisions-2010/2717115022","minor-civil-divisions-2010/2704915706":"minor-civil-divisions-2010/2704915706,minor-civil-divisions-2010/2713115706","minor-civil-divisions-2010/2713115706":"minor-civil-divisions-2010/2704915706,minor-civil-divisions-2010/2713115706","minor-civil-divisions-2010/2709318134":"minor-civil-divisions-2010/2709318134,minor-civil-divisions-2010/2714518134","minor-civil-divisions-2010/2714518134":"minor-civil-divisions-2010/2709318134,minor-civil-divisions-2010/2714518134","minor-civil-divisions-2010/2707919160":"minor-civil-divisions-2010/2707919160,minor-civil-divisions-2010/2716119160","minor-civil-divisions-2010/2716119160":"minor-civil-divisions-2010/2707919160,minor-civil-divisions-2010/2716119160","minor-civil-divisions-2010/2702325280":"minor-civil-divisions-2010/2702325280,minor-civil-divisions-2010/2717325280","minor-civil-divisions-2010/2717325280":"minor-civil-divisions-2010/2702325280,minor-civil-divisions-2010/2717325280","minor-civil-divisions-2010/2705326990":"minor-civil-divisions-2010/2705326990,minor-civil-divisions-2010/2717126990","minor-civil-divisions-2010/2717126990":"minor-civil-divisions-2010/2705326990,minor-civil-divisions-2010/2717126990","minor-civil-divisions-2010/2711731760":"minor-civil-divisions-2010/2711731760,minor-civil-divisions-2010/2713331760","minor-civil-divisions-2010/2713331760":"minor-civil-divisions-2010/2711731760,minor-civil-divisions-2010/2713331760","minor-civil-divisions-2010/2705533866":"minor-civil-divisions-2010/2705533866,minor-civil-divisions-2010/2716933866","minor-civil-divisions-2010/2716933866":"minor-civil-divisions-2010/2705533866,minor-civil-divisions-2010/2716933866","minor-civil-divisions-2010/2704934172":"minor-civil-divisions-2010/2704934172,minor-civil-divisions-2010/2715734172","minor-civil-divisions-2010/2715734172":"minor-civil-divisions-2010/2704934172,minor-civil-divisions-2010/2715734172","minor-civil-divisions-2010/2707936746":"minor-civil-divisions-2010/2707936746,minor-civil-divisions-2010/2714336746","minor-civil-divisions-2010/2714336746":"minor-civil-divisions-2010/2707936746,minor-civil-divisions-2010/2714336746","minor-civil-divisions-2010/2715743036":"minor-civil-divisions-2010/2715743036,minor-civil-divisions-2010/2716943036","minor-civil-divisions-2010/2716943036":"minor-civil-divisions-2010/2715743036,minor-civil-divisions-2010/2716943036","minor-civil-divisions-2010/2701343198":"minor-civil-divisions-2010/2701343198,minor-civil-divisions-2010/2704343198","minor-civil-divisions-2010/2704343198":"minor-civil-divisions-2010/2701343198,minor-civil-divisions-2010/2704343198","minor-civil-divisions-2010/2702144422":"minor-civil-divisions-2010/2702144422,minor-civil-divisions-2010/2709744422","minor-civil-divisions-2010/2709744422":"minor-civil-divisions-2010/2702144422,minor-civil-divisions-2010/2709744422","minor-civil-divisions-2010/2707945808":"minor-civil-divisions-2010/2707945808,minor-civil-divisions-2010/2713945808","minor-civil-divisions-2010/2713945808":"minor-civil-divisions-2010/2707945808,minor-civil-divisions-2010/2713945808","minor-civil-divisions-2010/2703746924":"minor-civil-divisions-2010/2703746924,minor-civil-divisions-2010/2713146924","minor-civil-divisions-2010/2713146924":"minor-civil-divisions-2010/2703746924,minor-civil-divisions-2010/2713146924","minor-civil-divisions-2010/2701347068":"minor-civil-divisions-2010/2701347068,minor-civil-divisions-2010/2710347068","minor-civil-divisions-2010/2710347068":"minor-civil-divisions-2010/2701347068,minor-civil-divisions-2010/2710347068","minor-civil-divisions-2010/2709148562":"minor-civil-divisions-2010/2709148562,minor-civil-divisions-2010/2716548562","minor-civil-divisions-2010/2716548562":"minor-civil-divisions-2010/2709148562,minor-civil-divisions-2010/2716548562","minor-civil-divisions-2010/2704148796":"minor-civil-divisions-2010/2704148796,minor-civil-divisions-2010/2715348796","minor-civil-divisions-2010/2715348796":"minor-civil-divisions-2010/2704148796,minor-civil-divisions-2010/2715348796","minor-civil-divisions-2010/2704951136":"minor-civil-divisions-2010/2704951136,minor-civil-divisions-2010/2710951136","minor-civil-divisions-2010/2710951136":"minor-civil-divisions-2010/2704951136,minor-civil-divisions-2010/2710951136","minor-civil-divisions-2010/2709552522":"minor-civil-divisions-2010/2709552522,minor-civil-divisions-2010/2714152522","minor-civil-divisions-2010/2714152522":"minor-civil-divisions-2010/2709552522,minor-civil-divisions-2010/2714152522","minor-civil-divisions-2010/2712753656":"minor-civil-divisions-2010/2712753656,minor-civil-divisions-2010/2712953656","minor-civil-divisions-2010/2712953656":"minor-civil-divisions-2010/2712753656,minor-civil-divisions-2010/2712953656","minor-civil-divisions-2010/2705355006":"minor-civil-divisions-2010/2705355006,minor-civil-divisions-2010/2717155006","minor-civil-divisions-2010/2717155006":"minor-civil-divisions-2010/2705355006,minor-civil-divisions-2010/2717155006","minor-civil-divisions-2010/2707755438":"minor-civil-divisions-2010/2707755438,minor-civil-divisions-2010/2713555438","minor-civil-divisions-2010/2713555438":"minor-civil-divisions-2010/2707755438,minor-civil-divisions-2010/2713555438","minor-civil-divisions-2010/2711156014":"minor-civil-divisions-2010/2711156014,minor-civil-divisions-2010/2716756014","minor-civil-divisions-2010/2716756014":"minor-civil-divisions-2010/2711156014,minor-civil-divisions-2010/2716756014","minor-civil-divisions-2010/2700956176":"minor-civil-divisions-2010/2700956176,minor-civil-divisions-2010/2709756176","minor-civil-divisions-2010/2709756176":"minor-civil-divisions-2010/2700956176,minor-civil-divisions-2010/2709756176","minor-civil-divisions-2010/2700356950":"minor-civil-divisions-2010/2700356950,minor-civil-divisions-2010/2705956950","minor-civil-divisions-2010/2705956950":"minor-civil-divisions-2010/2700356950,minor-civil-divisions-2010/2705956950","minor-civil-divisions-2010/2700958612":"minor-civil-divisions-2010/2700958612,minor-civil-divisions-2010/2714558612","minor-civil-divisions-2010/2714558612":"minor-civil-divisions-2010/2700958612,minor-civil-divisions-2010/2714558612","minor-civil-divisions-2010/2701960016":"minor-civil-divisions-2010/2701960016,minor-civil-divisions-2010/2705360016","minor-civil-divisions-2010/2705360016":"minor-civil-divisions-2010/2701960016,minor-civil-divisions-2010/2705360016","minor-civil-divisions-2010/2700361996":"minor-civil-divisions-2010/2700361996,minor-civil-divisions-2010/2712361996","minor-civil-divisions-2010/2712361996":"minor-civil-divisions-2010/2700361996,minor-civil-divisions-2010/2712361996","minor-civil-divisions-2010/2715362446":"minor-civil-divisions-2010/2715362446,minor-civil-divisions-2010/2715962446","minor-civil-divisions-2010/2715962446":"minor-civil-divisions-2010/2715362446,minor-civil-divisions-2010/2715962446","minor-civil-divisions-2010/2709763778":"minor-civil-divisions-2010/2709763778,minor-civil-divisions-2010/2715363778","minor-civil-divisions-2010/2715363778":"minor-civil-divisions-2010/2709763778,minor-civil-divisions-2010/2715363778","minor-civil-divisions-2010/2711167504":"minor-civil-divisions-2010/2711167504,minor-civil-divisions-2010/2715967504","minor-civil-divisions-2010/2715967504":"minor-civil-divisions-2010/2711167504,minor-civil-divisions-2010/2715967504","minor-civil-divisions-2010/2701339878":"minor-civil-divisions-2010/2701339878,minor-civil-divisions-2010/2707939878,minor-civil-divisions-2010/2710339878","minor-civil-divisions-2010/2707939878":"minor-civil-divisions-2010/2701339878,minor-civil-divisions-2010/2707939878, minor-civil-divisions-2010/2710339878","minor-civil-divisions-2010/2710339878":"minor-civil-divisions-2010/2701339878,minor-civil-divisions-2010/2707939878,minor-civil-divisions-2010/2710339878","minor-civil-divisions-2010/2700956896":"minor-civil-divisions-2010/2700956896,minor-civil-divisions-2010/2714156896,minor-civil-divisions-2010/2714556896","minor-civil-divisions-2010/2714156896":"minor-civil-divisions-2010/2700956896,minor-civil-divisions-2010/2714156896, minor-civil-divisions-2010/2714556896","minor-civil-divisions-2010/2714556896":"minor-civil-divisions-2010/2700956896,minor-civil-divisions-2010/2714156896,minor-civil-divisions-2010/2714556896"},e.jsonpRequest({url:this.app.options.boundaryAPI+"boundaries/?contains="+encodeURIComponent(this.options.lonlat[1])+","+encodeURIComponent(this.options.lonlat[0])+"&sets="+encodeURIComponent(this.app.options.boundarySets.join(","))},this.app.options).done(function(c){if(b.isArray(c.objects)){a.fullBoundaries=c.objects;var d=[];b.each(c.objects,function(a){var b=a.url.split("/"),c=b[2]+"/"+b[3];c=multiMCDs[c]?multiMCDs[c]:c,d.push(c)}),a.boundaries=d,a.trigger("fetchedBoundary")}})}}),f}),define("text!templates/application.mustache",[],function(){return'\n\n<a href="#"\n  on-tap="toggleFullscreen"\n  class="fullscreen-toggle"\n  title="{{^isFullscreen}}Enable{{/isFullscreen}}{{#isFullscreen}}Disable{{/isFullscreen}} fullscreen">\n  <i class="fa {{^isFullscreen}}fa-expand{{/isFullscreen}}{{#isFullscreen}}fa-compress{{/isFullscreen}}"></i>\n</a>\n\n<div class="fullscreen-overlay"></div>\n\n<div class="message-container">\n</div>\n\n<div class="content-container">\n</div>\n\n<div class="footnote-container">\n</div>\n'}),define("text!templates/footnote.mustache",[],function(){return'<div class="footnote">\n  <p>Unofficial election data provided by the <a href="http://www.sos.state.mn.us/" target="_blank">MN Secretary of State</a>.  For ranked-choice contests data is supplemented manually with data from the respective jurisdictions.  Test data will be provided until 8PM on Election Night.</p>\n\n  <p>The geographical boundaries, though received from official sources and queried from our <a href="https://represent-minnesota.herokuapp.com" target="_blank">boundary service</a>, may not represent the exact, offical area for a contest, race, or election.  It is also possible that for a given location the contests may not be accurate due to data quality with multiple agencies.  Please refer to your local and state election officials to know exactly what contests happen for a given location.</p>\n\n  <p>Some map data © OpenStreetMap contributors; licensed under the <a href="http://www.openstreetmap.org/copyright" target="_blank">Open Data Commons Open Database License</a>.  Some map design © MapBox; licensed according to the <a href="http://mapbox.com/tos/" target="_blank">MapBox Terms of Service</a>.  Location geocoding provided by <a href="http://www.mapquest.com/" target="_blank">Mapquest</a> and is not guaranteed to be accurate.</p>\n\n  <p>This application was designed and built by Alan Palazzolo, Kaeti Hinck and Tom Nehil. Some code, techniques, and data on <a href="https://github.com/minnpost/minnpost-elections-dashboard" target="_blank">Github</a>.</p>\n</div>\n'}),define("text!templates/contest.mustache",[],function(){return'<div class="contest {{#isDashboard}}dashboard-contest{{/isDashboard}} {{ classes }} {{#(ranked_choice == 1)}}is-ranked-choice {{/()}} {{#(final === true)}}is-final{{/()}} {{#primary}}primary{{/primary}} contest-{{id}}">\n  {{^isDashboard}}\n    <a class="dashboard-link" href="#dashboard">&larr; Back to dashboard</a>\n  {{/isDashboard}}\n\n  <div>\n    {{#((results.length == 0 || results == undefined) && !synced)}}\n      {{>loading}}\n    {{/()}}\n  </div>\n\n  {{#((results.length == 0 || results == undefined) && synced)}}\n    <h3>Did not find any contests</h3>\n  {{/()}}\n\n\n  {{#((results.length > 0) && synced)}}\n    <h3>\n      {{#(customTitle != undefined)}}{{ customTitle }}{{/()}}\n      {{#(customTitle == undefined)}}{{ title }}{{/()}}\n      {{#(show_party != undefined)}}<span class="show-party party-label bg-color-political-{{ show_party.toLowerCase() }}" title="{{ parties[show_party.toLowerCase()] }}">{{ show_party }}</span>{{/()}}\n    </h3>\n\n    {{#sub_title}}\n      <h5>{{ sub_title }}</h5>\n    {{/sub_title}}\n\n    {{^isDashboard}}\n      <div class="last-updated">Last updated {{ updated.formatToday() }}</div>\n    {{/isDashboard}}\n\n    {{#(!!question_body)}}\n      <p>{{{ question_body }}}</p>\n    {{/()}}\n\n    {{#percent_needed}}\n      <p><em>This contest requires {{ formatters.number(percent_needed, 1) }}% or more "yes" votes for the measure to pass.</em></p>\n    {{/percent_needed}}\n  {{/()}}\n\n  <div class="{{^isDashboard}}row{{/isDashboard}}">\n    <div class="{{^isDashboard}}column-medium-70 inner-column-left{{/isDashboard}}">\n      <div class="">\n        <table class="striped">\n          <thead>\n            <tr class="table-first-heading">\n              <th class="winner-column"></th>\n              <th>Candidate</th>\n              {{#(partisan && show_party === undefined)}}\n                <th>\n                  <span class="large-table-label">Party</span>\n                  <span class="small-table-label"></span>\n                </th>\n              {{/()}}\n              {{#(ranked_choice == 1)}}\n                <th class="first-choice-column">Results</th>\n                <th class="second-choice-column"></th>\n                <th class="third-choice-column"></th>\n                <th class="final-column">Final</th>\n              {{/()}}\n              {{#(ranked_choice != 1)}}\n                {{^isDashboard}}\n                  <th class="percentage">\n                    <span class="large-table-label">Percentage</span>\n                    <span class="small-table-label">%</span>\n                  </th>\n                  <th class="votes">Votes</th>\n                {{/isDashboard}}\n                {{#isDashboard}}\n                  <th class="percentage">Results</th>\n                {{/isDashboard}}\n              {{/()}}\n            </tr>\n            <tr class="table-second-heading">\n              <th class="winner-column"></th>\n              <th>{{ precincts_reporting }} of {{ total_effected_precincts }} precincts reporting.  {{#(seats > 1)}}Choosing {{ seats }}.{{/()}}</th>\n              {{#(partisan && show_party === undefined)}}\n                <th></th>\n              {{/()}}\n              {{#(ranked_choice == 1)}}\n                <th class="first-choice-column first-choice-heading">1st choice</th>\n                <th class="second-choice-column second-choice-heading">2nd choice</th>\n                <th class="third-choice-column third-choice-heading">3rd choice</th>\n                <th class="final-column"></th>\n              {{/()}}\n              {{#(ranked_choice != 1)}}\n                <th></th>\n                {{^isDashboard}}\n                  <th></th>\n                {{/isDashboard}}\n              {{/()}}\n            </tr>\n          </thead>\n\n          <tbody>\n            {{#results:r}} {{#(!isDashboard || ((show_party == undefined && (r < 2 || (rows != undefined && r < rows))) || (show_party && party_id == show_party)))}}\n              <tr data-row-id="{{ id }}" class="{{ (r % 2 === 0) ? \'even\' : \'odd\' }} {{#primary}}{{ party_id.toLowerCase() }}{{/primary}}">\n                <td class="winner-column">{{#(winner && called === "TRUE")}}<span class="fa fa-check"></span>{{/())}}</td>\n\n                <td class="candidate-column">{{ candidate }}</td>\n\n                {{#(partisan && show_party === undefined)}}\n                  <td>\n                    {{#([\'WI\', \'NP\'].indexOf(party_id) === -1)}}\n                      <span class="party-label bg-color-political-{{ party_id.toLowerCase() }}" title="{{ parties[party_id.toLowerCase()] }}">{{ party_id }}</span>\n                    {{/()}}\n                  </td>\n                {{/()}}\n\n                {{#(ranked_choice == 1)}}\n                  <td class="first-choice-column first-choice-heading">{{ formatters.number(ranked_choices.1.percentage) }}% ({{ formatters.number(ranked_choices.1.votes_candidate, 0) }}&nbsp;votes)</td>\n                  <td class="second-choice-column first-choice-heading">{{ formatters.number(ranked_choices.2.percentage) }}% ({{ formatters.number(ranked_choices.2.votes_candidate, 0) }}&nbsp;votes)</td>\n                  <td class="third-choice-column first-choice-heading">{{ formatters.number(ranked_choices.3.percentage) }}% ({{ formatters.number(ranked_choices.3.votes_candidate, 0) }}&nbsp;votes)</td>\n                  <td class="final-column first-choice-heading">{{#ranked_choices.100.percentage}}{{ formatters.number(ranked_choices.100.percentage) }}% ({{ formatters.number(ranked_choices.100.votes_candidate, 0) }}&nbsp;votes){{/ranked_choices.100.percentage}}{{^ranked_choices.100.percentage}}&mdash;{{/ranked_choices.100.percentage}}</td>\n                {{/()}}\n\n                {{#(ranked_choice != 1)}}\n                  <td class="percentage">{{ formatters.number(percentage) }}%</td>\n                  {{^isDashboard}}\n                    <td class="votes">{{ formatters.number(votes_candidate, 0) }}</td>\n                  {{/isDashboard}}\n                {{/()}}\n              </tr>\n            {{/()}} {{/results}}\n          </tbody>\n        </table>\n      </div>\n      \n      <a href="#contest/{{ id }}" class="contest-link">{{#isDashboard}}Full results{{/isDashboard}}{{^isDashboard}}Permalink{{/isDashboard}}</a>\n    </div>\n\n\n\n    {{^isDashboard}}\n      <div class="column-medium-30 inner-column-right">\n        <div class="contest-map" id="contest-map-{{ id }}"></div>\n      </div>\n    {{/isDashboard}}\n  </div>\n</div>\n'}),define("text!templates/contests.mustache",[],function(){return'<div class="contests">\n  <a class="dashboard-link" href="#dashboard">&larr; Back to dashboard</a>\n\n  <div class="row">\n    <div class="column-medium-70 inner-column-left contests-title-section">\n      <h2 class="contests-title {{#(lonlat != undefined)}}with-location{{/()}}">{{ (title) ? title : \'Contests\' }}</h2>\n\n      <p class="caption">\n        Found\n          {{#(models.length == 0 && !synced)}}\n            <i class="loading small"></i>\n          {{/())}}\n          {{#synced}}\n            {{ models.length }}\n          {{/synced}}\n        results.\n      </p>\n\n      {{#(lonlat != undefined)}}\n        <p class="caption">The map below shows the approximate location of your search. If the location is not correct, try <a href="#dashboard">searching for a more specific address</a>.</p>\n\n        <div id="location-map"></div>\n      {{/())}}\n    </div>\n\n    <div class="column-medium-30 inner-column-right"></div>\n  </div>\n\n  <div>\n    {{#(models.length == 0 && !synced)}}\n      {{>loading}}\n    {{/())}}\n\n    {{#(models.length == 0 && synced)}}\n      <p class="large">Unable to find any contests.</p>\n    {{/())}}\n  </div>\n\n  <div class="contest-list">\n    {{#models:i}}\n      {{>contest}}\n    {{/models}}\n  </div>\n</div>\n'}),define("text!templates/dashboard.mustache",[],function(){return'<div class="dashboard {{ classes }}">\n\n  <div class="location-search-section">\n    <form role="form" class="" on-submit="addresssSearch">\n\n      <div class="location-search-group">\n        <div class="form-input-group">\n          <label for="address" class="sr-only">Search address for results</label>\n          <input type="text" id="address-search" placeholder="Search address for results">\n\n          <div class="button-group">\n            <button type="submit" class="button primary address-search-submit">Search</button>\n          </div>\n        </div>\n      </div>\n\n      {{#geolocationEnabled}}\n        <div class="geolocation">\n          <a href="#location">Or view contests at your current location <i class="fa fa-location-arrow"></i></a>\n        </div>\n      {{/geolocationEnabled}}\n    </form>\n  </div>\n\n  <div class="last-updated-section">\n    <div>\n      {{#election.date}}\n        {{ election.date.format(\'MMM DD, YYYY\') }} {{ (election.primary) ? \'primary\' : \'general\' }} election {{#election.isTest}}<em>test</em>{{/election.isTest}} results.\n      {{/election.date}}\n      {{#election.updated}}\n        Last updated {{ election.updated.formatToday() }}\n      {{/election.updated}}\n    </div>\n  </div>\n\n  <div class="row">\n    <div class="column-medium-50">\n      <div class="inner-column-left">\n        {{#dashboard:di}}{{#(di < dashboard.length / 2)}}\n          <div class="{{ itemClass }} dashboard-section">\n            {{#(type === \'race\')}}\n              {{>contest}}\n            {{/()}}\n\n            {{#(type === \'custom\')}}\n              {{>stateLeg}}\n            {{/()}}\n\n            {{#(type === \'spacer\')}}\n            {{/()}}\n\n            {{#(type === \'links\')}}\n              <h4>Other elections</h4>\n              <ul class="other-elections">\n                {{#links}}\n                  <li><a href="{{ href }}">{{ text }}</a></li>\n                {{/links}}\n              </ul>\n            {{/()}}\n          </div>\n        {{/()}}{{/dashboard}}\n\n        <div class="elections-search dashboard-section">\n          <h4>Search elections</h4>\n          {{>electionsSearch}}\n        </div>\n      </div>\n    </div>\n\n    <div class="column-medium-50">\n      <div class="inner-column-right">\n        {{#dashboard:di}}{{#(di >= dashboard.length / 2)}}\n          <div class="{{ itemClass }} dashboard-section">\n            {{#(type === \'race\')}}\n              {{>contest}}\n            {{/()}}\n\n            {{#(type === \'custom\')}}\n              {{>stateLeg}}\n            {{/()}}\n\n            {{#(type === \'spacer\')}}\n            {{/()}}\n\n            {{#(type === \'links\')}}\n              <h4>Other elections</h4>\n              <ul class="other-elections">\n                {{#links}}\n                  <li><a href="{{ href }}">{{ text }}</a></li>\n                {{/links}}\n              </ul>\n            {{/()}}\n          </div>\n        {{/()}}{{/dashboard}}\n\n        <div class="elections-search dashboard-section">\n          <h4>Search elections</h4>\n          {{>electionsSearch}}\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("text!templates/loading.mustache",[],function(){return'<div class="loading-container">\n  <i class="loading"></i> Loading...\n</div> \n'}),define("text!templates/elections-search-form.mustache",[],function(){return'<form role="form" class="" on-submit="contestSearch">\n\n  <p class="caption" for="contest-search">Search for any election across the state by title or candidate.  Start typing to see suggestions for specific elections, then click on one listed.  Or enter some keywords and hit the Search button (e.g., "<a href="#search/u.s.+representative">U.S. representative</a>" or "<a href="#search/school+board">school board</a>").</p>\n\n  <div class="form-input-group">\n    <input type="text" class="contest-search" placeholder="Search by title{{#capabilities.typeahead}} or candidate{{/capabilities.typeahead}}" />\n\n    <div class="button-group">\n      <button type="submit" class="button primary contest-search-submit">Search</button>\n    </div>\n  </div>\n</form>\n'}),define("views",["jquery","underscore","backbone","ractive","ractive-events-tap","ractive-backbone","leaflet","models","collections","bloodhound","typeahead-js","placeholders-js","mpConfig","mpFormatters","text!templates/application.mustache","text!templates/footnote.mustache","text!templates/contest.mustache","text!templates/contests.mustache","text!templates/dashboard.mustache","text!templates/loading.mustache","text!templates/elections-search-form.mustache"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v={};return v.highlightDecorator=function(b,c){return{update:function(){var c=a(b);c.removeClass("unhighlight"),c.addClass("highlight"),setTimeout(function(){c.addClass("unhighlight")},200)},teardown:function(){}}},d.decorators.highlight=v.highlightDecorator,v.ApplicationView=d.extend({init:function(){this.set("parties",m.politicalParties)},template:o}),v.FootnoteView=d.extend({init:function(){},template:p}),v.ContestBaseView=d.extend({defaultMapStyle:{stroke:!0,color:"#2DA51D",weight:1.5,opacity:.9,fill:!0,fillColor:"#2DA51D",fillOpacity:.2,clickable:!1},adapt:["Backbone"],makeMap:function(a,c){var d,e,f,h=this,i={};c=b.isArray(c)?c:[c],c=b.filter(c,function(a){return!!b.isUndefined(i[a.slug])&&(i[a.slug]=!0,!0)}),e=b.map(c,function(a,b){return a.simple_shape}),f=new g.Map(a,{zoom:10,center:[44.98,-93.2636],scrollWheelZoom:!1,trackResize:!0,zoomControl:!1,dragging:!1}),f.addControl(new g.Control.Zoom({position:"topright"})),f.attributionControl.setPrefix(!1),f.addLayer(new g.tileLayer("//{s}.tiles.mapbox.com/v3/minnpost.map-wi88b700/{z}/{x}/{y}.png")),d=new g.featureGroup,b.each(e,function(a){var b=new g.geoJson(a);b.setStyle(h.defaultMapStyle),d.addLayer(b)}),f.addLayer(d),window.setTimeout(function(){f.fitBounds(d.getBounds())},500)},observeTitle:function(a){this.observe("title",function(b,c){b&&(document.title=a?b+" | "+a:b)})}}),v.DashboardView=v.ContestBaseView.extend({template:s,partials:{contest:q,loading:t,electionsSearch:u},init:function(c){var d,e,f=this,g=a(this.el).find(".contest-search");this.app=c.app,this.set("formatters",n),this.set("parties",m.politicalParties),d=this.app.options.electionsAPI+"SELECT c.id AS id, title AS title FROM contests AS c WHERE c.title LIKE '%%QUERY%' OR c.sub_title LIKE '%%QUERY%' UNION SELECT c.id AS id, r.candidate || ' (' || c.title || ')' AS title FROM results AS r JOIN contests AS c ON r.contest_id = c.id WHERE r.candidate LIKE '%%QUERY%' ORDER BY title LIMIT 20 ",e=new j({name:"Contests and Candidates",datumTokenizer:j.tokenizers.obj.whitespace("title"),queryTokenizer:j.tokenizers.whitespace,remote:{url:d,replace:function(a,b){var c=decodeURIComponent(b);return c=c.replace(new RegExp(" ","g"),"%"),encodeURI(a.replace(new RegExp(this.wildcard,"g"),c))},ajax:{dataType:"jsonp",jsonpCallback:"mpServerSideCachingHelper"}}}),e.initialize(),g.each(function(){a(this).typeahead(null,{displayKey:"title",source:e.ttAdapter(),minLength:3,hint:!0,highlight:!0}),a(this).on("typeahead:selected",function(a,b,c){f.app.router.navigate("/contest/"+b.id,{trigger:!0})})}),this.on("teardown",function(){g.typeahead("destroy")}),this.set("geolocationEnabled",b.isObject(navigator)&&b.isObject(navigator.geolocation))}}),v.ContestView=v.ContestBaseView.extend({template:q,partials:{loading:t},init:function(){this.set("classes","contest-view"),this.set("formatters",n),this.set("parties",m.politicalParties),this.observe("fetchedBoundary",function(a,b){a&&this.makeMap("contest-map-"+this.get("id"),this.get("boundarySets"))})}}),v.ContestsView=v.ContestBaseView.extend({template:r,partials:{contest:q,loading:t},init:function(){var a=this,c={};this.set("formatters",n),this.set("parties",m.politicalParties),this.observe("models.*.fetchedBoundary",function(a,d,e){var f=e.split("."),g=this.get(f[0]+"."+f[1]);a&&b.isArray(g.get("boundarySets"))&&b.isObject(g.get("boundarySets")[0])&&b.isObject(g)&&!c[g.get("id")]&&(c[g.get("id")]=!0,this.makeMap("contest-map-"+g.get("id"),g.get("boundarySets")))}),this.data.models.on("sync",function(){a.set("synced",!0)}),this.observe("lonlat",function(a,c){var d,e,f=a;b.isArray(f)&&b.isNumber(f[0])&&(d=new g.Map("location-map",{zoom:13,center:[f[1],f[0]],scrollWheelZoom:!1,trackResize:!0,zoomControl:!1,dragging:!1}),d.attributionControl.setPrefix(!1),d.addLayer(new g.tileLayer("//{s}.tiles.mapbox.com/v3/minnpost.map-wi88b700/{z}/{x}/{y}.png")),e=new g.circleMarker([f[1],f[0]],10),e.setStyle(this.defaultMapStyle),d.addLayer(e))})}}),v}),define("routers",["jquery","underscore","backbone","models","collections","views"],function(a,b,c,d,e,f){var g={};return g.DashboardRouter=c.Router.extend({initialize:function(a){this.options=a,this.app=a.app,this.app.options.interfaceRefresh&&window.setTimeout(function(){document.location.reload(!0)},this.app.options.interfaceRefresh)},routes:{dashboard:"routeDashboard","search/:term":"routeSearch","contest/:contest":"routeContest","location(/:place)":"routeLocation","*default":"routeDefault"},start:function(){c.history.start()},routeDefault:function(){this.navigate("/dashboard",{trigger:!0,replace:!0})},routeDashboard:function(){var c=this,e={},g={};this.teardownObjects(),this.app.dashboardContests={},e.dashboard=b.map(this.options.dashboard,function(a,e){var f;return"race"===a.type?(f=new d.ContestModel(a,{app:c.app}),f.connect(!1),f.set("isDashboard",!0),c.app.dashboardContests[a.id]=f,f):"custom"===a.type?(f=new d.CustomQuery({type:a.type},b.extend(a,{app:c.app})),f.connect(),f.set("isDashboard",!0),g.stateLeg=a.template,c.app.dashboardContests[a.id]=f,f):a}),this.app.election=new d.ElectionModel({},{app:this.app}),e.election=this.app.election,this.app.election.connect(),e.title="Dashboard",this.app.dashboardView=new f.DashboardView({el:this.app.$el.find(".content-container"),data:e,app:this.app,partials:g}),this.app.dashboardView.on("addresssSearch",function(b){var d=a(this.el).find("#address-search").val();b.original.preventDefault(),d&&c.navigate("/location/"+encodeURIComponent(d),{trigger:!0})}),this.app.dashboardView.on("contestSearch",function(b){b.original.preventDefault();var d=a(b.node).find(".contest-search.tt-input"),e=d.val();e&&c.navigate("/search/"+encodeURIComponent(e),{trigger:!0})}),this.app.dashboardView.observeTitle(this.app.options.originalTitle),this.reFocus()},routeSearch:function(a){this.teardownObjects(),this.app.contestsSearch=new e.ContestsCollection([],{app:this.app,search:a}),this.app.contestsSearch.connect(),this.app.contestsSearchView=new f.ContestsView({el:this.app.$el.find(".content-container"),data:{models:this.app.contestsSearch,title:'Search for "'+a.replace(/\+/g," ")+'"'}}),this.app.contestsSearchView.observeTitle(this.app.options.originalTitle),this.reFocus()},routeContest:function(a){this.teardownObjects(),this.app.contest=new d.ContestModel({id:a},{app:this.app}),this.app.contest.connect(),this.app.contestView=new f.ContestView({el:this.app.$el.find(".content-container"),data:this.app.contest}),this.app.contestView.observeTitle(this.app.options.originalTitle),this.reFocus()},routeLocation:function(a){function c(b){d.app.locationContests=new e.ContestsLocationCollection([],{app:d.app,lonlat:b}),d.app.locationContests.fetchBoundaryFromCoordinates(),d.app.contestsLocationView=new f.ContestsView({el:d.app.$el.find(".content-container"),data:{models:d.app.locationContests,title:a?'Contests for "'+a+'"':"Contests for your location",lonlat:b}}),d.app.contestsLocationView.observeTitle(d.app.options.originalTitle),d.reFocus()}var d=this;this.teardownObjects(),a?/[a-zA-Z]+/.test(a)||b.isNaN(parseFloat(a.split(",")[0]))||b.isNaN(parseFloat(a.split(",")[1]))?this.addressLocate(a).done(function(a){c(a)}):c([parseFloat(a.split(",")[0]),parseFloat(a.split(",")[1])]):this.geolocate().done(function(a){c(a)})},geolocate:function(){var b=this,c=a.Deferred();return navigator.geolocation.getCurrentPosition(function(a){c.resolveWith(b,[[a.coords.longitude,a.coords.latitude]])},function(a){c.rejectWith(b,[{message:"Issue retrieving current position."}])}),c.promise()},addressLocate:function(c){var d=this,e=a.Deferred(),f=this.app.options.mapQuestQuery.replace("[[[KEY]]]",this.app.options.mapQuestKey).replace("[[[ADDRESS]]]",encodeURIComponent(c));return a.ajax({dataType:"jsonp",url:f}).done(function(a){var c;b.size(a.results[0].locations)>0&&b.isObject(a.results[0].locations[0].latLng)?(c=a.results[0].locations[0].latLng,e.resolveWith(d,[[c.lng,c.lat]])):e.rejectWith(d,[{message:"Issue retrieving position from address."}])}).fail(function(){e.rejectWith(d,arguments)}),e.promise()},reFocus:function(){this.viewed&&a("html, body").animate({scrollTop:this.app.$el.offset().top-5},750),this.viewed=!0},teardownObjects:function(){var a=this,c=["contestView","contestsSearchView","contestsLocationView"],d=["contest","contestsSearch","locationContests","election"];b.isObject(this.app.dashboardContests)&&(d=b.union(d,b.keys(this.app.dashboardContests))),b.each(d,function(c){b.isObject(a.app[c])&&(a.app[c].stopListening(),a.app[c].disconnect())}),b.each(c,function(c){b.isObject(a.app[c])&&(b.isObject(a.app[c].map),a.app[c].teardown(),delete a.app[c])})}}),g}),define("text!templates/dashboard-state-leg.mustache",[],function(){return'<div class="dashboard-state-leg">\n  <h3>{{#(chamber === "senate")}}MN Senate{{/()}}{{#(chamber === "house")}}MN House of Representatives{{/()}}</h3>\n\n  {{#note}}<p class="small">{{ note }}</p>{{/note}}\n\n  {{#(!contests.length)}}\n    {{>loading}}\n  {{/()}}\n\n  <div class="state-leg-boxes cf">\n    <div class="state-leg-boxes-left">\n      {{#contests:ci}}{{#(ci < contests.length / 2)}}\n        <a href="#/contest/{{ id }}" class="\n          {{#(!done && some)}}some{{/()}}\n          {{#done}}done bg-color-political-{{ partyWon.toLowerCase() }}{{/done}}\n          {{#tooclose}}too-close-to-call{{/tooclose}}\n          {{#partyShift}}party-shift{{/partyShift}}\n          state-leg-box" title="{{ title }}"></a>\n      {{/()}}{{/contests}}\n    </div>\n    <div class="state-leg-boxes-right">\n      {{#contests:ci}}{{#(ci >= contests.length / 2)}}\n        <a href="#/contest/{{ id }}" class="\n          {{#(!done && some)}}some{{/()}}\n          {{#done}}done bg-color-political-{{ partyWon.toLowerCase() }}{{/done}}\n          {{#tooclose}}too-close-to-call{{/tooclose}}\n          {{#partyShift}}party-shift{{/partyShift}}\n          state-leg-box" title="{{ title }}"></a>\n      {{/()}}{{/contests}}\n    </div>\n  </div>\n\n  <div class="state-leg-totals">\n    {{#counts:ci}}\n      <span class="color-political-{{ id.toLowerCase() }}  {{^party}}too-close-to-call{{/party}}" title="{{ party }}{{^party}}Too close to call{{/party}}">{{ count }}</span>\n      {{#(ci < counts.length - 1)}} -&nbsp; {{/()}}\n    {{/counts}}\n  </div>\n\n  <div class="state-leg-legend">\n    <div class="legend-item">\n      <div class="legend-box unknown"></div> Not reporting yet\n    </div>\n\n    <div class="legend-item">\n      <div class="legend-box some"></div> Some reporting\n    </div>\n\n    <div class="legend-item">\n      <div class="legend-box solid"></div> Colored box is fully reported\n    </div>\n\n    <div class="legend-item">\n      <div class="legend-box too-close-to-call"></div> Too close to call\n    </div>\n\n    <div class="legend-item">\n      <div class="legend-box party-shift"></div> District set to change parties\n    </div>\n  </div>\n\n  {{#(chamber === "house")}}\n    <div class="state-leg-rnet">\n      <div class="heading">\n        Current Republican net gain:\n        <span class="color-political-r rnet">\n          {{ (rNet > 0) ? \'+\' : \'\' }}{{ rNet }}\n        </span>\n      </div>\n      <div class="sub-heading">Republicans need a net gain of at least +9 to win control of the House.</div>\n    </div>\n  {{/()}}\n\n  {{#(chamber === "senate")}}\n    <div class="state-leg-rnet">\n      <div class="heading">\n        Current DFL net gain:\n        <span class="color-political-dfl rnet">\n          {{ (dflNet > 0) ? \'+\' : \'\' }}{{ dflNet }}\n        </span>\n      </div>\n      <div class="sub-heading">DFLers need a net gain of at least +2 to win control of the Senate.</div>\n    </div>\n  {{/()}}\n\n</div>\n\n<script>\n\n<\/script>\n'}),require(["jquery","underscore","screenfull","base","helpers","views","routers","mpConfig","text!templates/dashboard-state-leg.mustache"],function(a,b,c,d,e,f,g,h,i){return new(d.BaseApp.extend({defaults:{name:"minnpost-elections-dashboard",remoteProxy:"//mp-jsonproxy.herokuapp.com/proxy?callback=?&url=",el:".minnpost-elections-dashboard-container",interfaceRefresh:18e5,electionsAPIPollInterval:5e4,electionsAPI:"https://elections-scraper.minnpost.com/?box=ubuntu/minnpost-scraper-mn-election-results&method=sql&q=",boundaryAPI:"//represent-minnesota.herokuapp.com/",boundarySets:["minor-civil-divisions-2010","wards-2012","minnesota-state-2014","school-districts-2018","minneapolis-parks-and-recreation-districts-2014","congressional-districts-2012","state-senate-districts-2012","state-house-districts-2012","hospital-districts-2012","district-courts-2012","county-commissioner-districts-2012","counties-2010"],npParties:["WI","NP"],mapQuestKey:"Fmjtd%7Cluur20a7n0%2C8n%3Do5-9a1s9f",mapQuestQuery:"//open.mapquestapi.com/geocoding/v1/address?key=[[[KEY]]]&outFormat=json&countrycodes=us&maxResults=1&location=[[[ADDRESS]]]",originalTitle:document.title,dashboard:[{title:"U.S. President",type:"race",id:"id-MN----0101",rows:2},{title:"U.S. Senate",type:"race",id:"id-MN----0102",rows:2},{title:"U.S. House — First District",type:"race",id:"id-MN---1-0104",rows:2},{title:"U.S. House — Second District",type:"race",id:"id-MN---2-0105",rows:2},{title:"U.S. House – Seventh District",type:"race",id:"id-MN---7-0110",rows:2},{type:"custom",id:"state-sen",template:i,query:"SELECT r.id AS results_id, r.candidate, r.party_id, r.percentage, c.id, c.title, c.precincts_reporting, c.total_effected_precincts, c.incumbent_party, c.called FROM contests AS c LEFT JOIN results AS r ON c.id = r.contest_id WHERE title LIKE '%state senator%' ORDER BY c.title, r.percentage, r.candidate ASC LIMIT 400",parse:function(a,c){var d={};return d.chamber="senate",d.note="Solid colored boxes indicate the party that is leading with all precincts reporting. If the lead is within 3 percentage points, the race is instead marked too close to call. Vote totals may change as more ballots are counted after Election Day.",d.contests={},b.each(a,function(a,b){d.contests[a.id]=d.contests[a.id]||{id:a.id,title:a.title,precincts_reporting:a.precincts_reporting,total_effected_precincts:a.total_effected_precincts,incumbent_party:a.incumbent_party,called:a.called,toolcose:!1,results:[]},d.contests[a.id].results.push({id:a.results_id,candidate:a.candidate,party_id:a.party_id,percentage:a.percentage})}),d.contests=b.map(d.contests,function(a,c){return a.done=a.precincts_reporting===a.total_effected_precincts,a.some=a.precincts_reporting>0,a.partyWon=b.max(a.results,function(a,b){return a.percentage}).party_id,a.partyShift=a.partyWon!==a.incumbent_party&&a.done,a.results=b.sortBy(a.results,"candidate").reverse(),a.results=b.sortBy(a.results,"percentage").reverse(),a.done&&a.results[0].percentage-a.results[1].percentage<3&&!a.called&&(a.partyWon="",a.partyShift=!1,a.tooclose=!0),a}),d.contests=b.sortBy(d.contests,"title"),d.contests=b.sortBy(d.contests,"partyShift").reverse(),d.contests=b.sortBy(d.contests,function(a,b){return a.done?"DFL"===a.partyWon?"AAAADFL":"R"===a.partyWon?"ZZZZZR":"MMMMMM"+a.partyWon:a.some?"MMMAAAAAA":"MMMMMM"}),d.counts={},b.each(d.contests,function(a,b){a.done?d.counts[a.partyWon]?d.counts[a.partyWon].count+=1:d.counts[a.partyWon]={id:a.tooclose?"YYYYYYYtooclose":a.partyWon,count:1,party:h.politicalParties[a.partyWon.toLowerCase()]}:d.counts.unknown?d.counts.unknown.count+=1:d.counts.unknown={id:"MMMMMMMunknown",count:1,party:"Not fully reported yet"}}),d.counts=b.sortBy(d.counts,"id"),d.dflNet=0,b.each(d.contests,function(a,b){a.done&&a.partyShift&&"DFL"===a.partyWon&&(d.dflNet+=1),a.done&&a.partyShift&&"DFL"===a.incumbent_party&&(d.dflNet-=1)}),d.allDone=b.where(d.contests,{done:!0}).length===d.contests.length,d}},{type:"custom",id:"state-leg",template:i,query:"SELECT r.id AS results_id, r.candidate, r.party_id, r.percentage, c.id, c.title, c.precincts_reporting, c.total_effected_precincts, c.incumbent_party, c.called FROM contests AS c LEFT JOIN results AS r ON c.id = r.contest_id WHERE title LIKE '%state representative%' ORDER BY c.title, r.percentage, r.candidate ASC LIMIT 425",parse:function(a,c){var d={};return d.chamber="house",d.contests={},b.each(a,function(a,b){d.contests[a.id]=d.contests[a.id]||{id:a.id,title:a.title,precincts_reporting:a.precincts_reporting,total_effected_precincts:a.total_effected_precincts,incumbent_party:a.incumbent_party,called:a.called,toolcose:!1,results:[]},d.contests[a.id].results.push({id:a.results_id,candidate:a.candidate,party_id:a.party_id,percentage:a.percentage})}),d.contests=b.map(d.contests,function(a,c){return a.done=a.precincts_reporting===a.total_effected_precincts,a.some=a.precincts_reporting>0,a.partyWon=b.max(a.results,function(a,b){return a.percentage}).party_id,a.partyShift=a.partyWon!==a.incumbent_party&&a.done,a.results=b.sortBy(a.results,"candidate").reverse(),a.results=b.sortBy(a.results,"percentage").reverse(),a.done&&a.results[0].percentage-a.results[1].percentage<3&&!a.called&&(a.partyWon="",a.partyShift=!1,a.tooclose=!0),a}),d.contests=b.sortBy(d.contests,"title"),d.contests=b.sortBy(d.contests,"partyShift").reverse(),d.contests=b.sortBy(d.contests,function(a,b){return a.done?"DFL"===a.partyWon?"AAAADFL":"R"===a.partyWon?"ZZZZZR":"MMMMMM"+a.partyWon:a.some?"MMMAAAAAA":"MMMMMM"}),d.counts={},b.each(d.contests,function(a,b){a.done?d.counts[a.partyWon]?d.counts[a.partyWon].count+=1:d.counts[a.partyWon]={id:a.tooclose?"YYYYYYYtooclose":a.partyWon,count:1,party:h.politicalParties[a.partyWon.toLowerCase()]}:d.counts.unknown?d.counts.unknown.count+=1:d.counts.unknown={id:"MMMMMMMunknown",count:1,party:"Not fully reported yet"}}),d.counts=b.sortBy(d.counts,"id"),d.rNet=0,b.each(d.contests,function(a,b){a.done&&a.partyShift&&"R"===a.partyWon&&(d.rNet+=1),a.done&&a.partyShift&&"R"===a.incumbent_party&&(d.rNet-=1)}),d.allDone=b.where(d.contests,{done:!0}).length===d.contests.length,d}},{title:"Associate Justice of the Supreme Court",type:"race",id:"id-MN----7005",rows:2},{type:"links",itemClass:"dashboard-links",links:[{href:"#search/u.s.+representative",text:"All U.S. House races"},{href:"#search/hennepin+county+commissioner",text:"Hennepin County commissioner races"},{href:"#search/ramsey+county+commissioner",text:"Ramsey County commissioner races"},{href:"#contest/id-MN---1-1-5000",text:"Minneapolis school board at-large"},{href:"#search/question",text:"All ballot questions"}]}]},initialize:function(){var d=this;e.overrideBackboneAJAX(),this.applicationView=new f.ApplicationView({el:this.$el}),this.footnoteView=new f.FootnoteView({el:this.$el.find(".footnote-container")}),this.applicationView.on("toggleFullscreen",function(a){a.original.preventDefault(),this.set("isFullscreen",!this.get("isFullscreen")),d.$el.toggleClass("fullscreen"),c.enabled&&c.toggle()}),c.enabled&&a(document).on(c.raw.fullscreenchange,function(){c.isFullscreen?(d.applicationView.set("isFullscreen",!0),d.$el.addClass("fullscreen")):(d.applicationView.set("isFullscreen",!1),d.$el.removeClass("fullscreen"))}),this.router=new g.DashboardRouter(b.extend(this.options,{app:this})),this.router.start()}}))({})}),define("app",function(){});